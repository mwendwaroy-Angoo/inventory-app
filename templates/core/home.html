<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Inventory Management System</title>
    {% load django_bootstrap5 %}
    {% bootstrap_css %}
    {% bootstrap_javascript %}
    <style>
        body { background-color: #f8f9fa; }
        .header { background-color: #0d6efd; color: white; padding: 30px; text-align: center; border-radius: 8px; margin-bottom: 30px; }
        .stat-card { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); text-align: center; }
        .reorder-alert { background-color: #fff3cd; border-left: 5px solid #ffc107; }
        .low-stock { background-color: #f8d7da; border-left: 5px solid #dc3545; }
        a.btn { margin: 10px; }

        @media (max-width: 768px) {
            .table { font-size: 0.9rem; }
            .btn { width: 100%; margin-bottom: 10px; }  /* Stack buttons */
            .search-box { margin: 10px; }
            .stat-card { margin-bottom: 20px; }  /* Stack cards */
        }
    </style>
</head>
<body>
    <div class="container mt-5">
        <!-- Login/Logout bar -->
        <div class="text-end mb-3">
            {% if user.is_authenticated %}
                <small>Hello, <strong>{{ user.username }}</strong> | <a href="{% url 'logout' %}">Logout</a></small>
            {% else %}
                <small><a href="{% url 'login' %}">Staff Login</a></small>
            {% endif %}
        </div>

               <!-- Main action buttons -->
        <div class="text-center mb-4">
            <a href="{% url 'stock_list' %}" class="btn btn-primary btn-lg">View Full Stock List</a>
            <a href="{% url 'transaction_history' %}" class="btn btn-info btn-lg">View Transaction History</a>

            {% if perms.core.add_transaction %}
            <a href="{% url 'add_transaction' %}" class="btn btn-success btn-lg">Add New Transaction</a>
            {% endif %}
        </div>

        <!-- Header -->
        <div class="header">
            <h1>Stock Control System</h1>
            <p class="lead">SF Computer & Maintenance Stores</p>
            <p><strong>Date:</strong> {{ today }}</p>
        </div>

        <!-- Stats cards -->
        <div class="row mb-4">
            <div class="col-md-4">
                <div class="stat-card">
                    <h4>Total Items</h4>
                    <h2 class="text-primary">{{ total_items }}</h2>
                </div>
            </div>
            <div class="col-md-4">
                <div class="stat-card">
                    <h4>Low Stock Items</h4>
                    <h2 class="text-warning">{{ low_stock_count }}</h2>
                </div>
            </div>
            <div class="col-md-4">
                <div class="stat-card">
                    <h4>Needs Reorder</h4>
                    <h2 class="text-danger">{{ reorder_count }}</h2>
                </div>
            </div>
        </div>

        <!-- Urgent reorder table -->
        {% if reorder_items %}
        <h3 class="mt-5">ðŸš¨ Items Needing Urgent Reorder</h3>
        <div class="table-responsive">
            <table class="table table-striped">
                <thead class="table-dark">
                    <tr>
                        <th>Material No</th>
                        <th>Description</th>
                        <th>Unit</th>
                        <th>Current Stock</th>
                        <th>Reorder Level</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in reorder_items %}
                    <tr class="{% if item.current_balance < 0 %}low-stock{% else %}reorder-alert{% endif %}">
                        <td><strong>{{ item.material_no }}</strong></td>
                        <td>{{ item.description }}</td>
                        <td>{{ item.unit }}</td>
                        <td>{{ item.current_balance }}</td>
                        <td>{{ item.reorder_level }}</td>
                        <td>
                            {% if item.current_balance <= 0 %}
                                <span class="badge bg-danger">OUT OF STOCK</span>
                            {% else %}
                                <span class="badge bg-warning">LOW STOCK</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="alert alert-success mt-4">
            <h4>âœ… All items are above reorder level. Great job!</h4>
        </div>
        {% endif %}
    </div>
</body>
</html>